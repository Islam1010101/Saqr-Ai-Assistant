import React, { useState, useMemo } from 'react';
import { useLanguage } from '../App';
import { useNavigate } from 'react-router-dom';

// --- English Library Database (18 Titles with Full Bios & Summaries) ---
const ENGLISH_LIBRARY_DATABASE = [
  { 
    id: 1, 
    title: "Me Before You", 
    author: "Jojo Moyes", 
    subject: "Drama", 
    driveLink: "https://drive.google.com/file/d/1eDq03Myjh56IRtLx1LIRJHa39PLnMvgf/view?usp=drive_link", 
    bio: "A bestselling British novelist and journalist, world-renowned for her deeply emotional storytelling and complex characters.", 
    summary: "An emotional journey exploring the life-changing relationship between a young woman and a man who has lost his will to live." 
  },
  { 
    id: 2, 
    title: "The Great Gatsby", 
    author: "Scott Fitzgerald", 
    subject: "Drama", 
    driveLink: "https://drive.google.com/file/d/1NjrAuiFno2Aa-z6WYkRI17oD2Hxkvs-M/view?usp=drive_link", 
    bio: "A premier American novelist of the 20th century, famous for capturing the extravagance and disillusionment of the Jazz Age.", 
    summary: "A timeless masterpiece that examines the dark side of the American Dream through the mysterious millionaire Jay Gatsby." 
  },
  { 
    id: 3, 
    title: "The Kite Runner", 
    author: "Khaled Hosseini", 
    subject: "Drama", 
    driveLink: "https://drive.google.com/file/d/1O_WhsHwUQIEMVB8x7tNOI-GHNExJcQLT/view?usp=drive_link", 
    bio: "An Afghan-American novelist whose works vividly portray the human spirit, family bonds, and the history of Afghanistan.", 
    summary: "A powerful story of friendship, betrayal, and redemption set against the turbulent backdrop of a changing world." 
  },
  { 
    id: 4, 
    title: "And Then There Were NONE", 
    author: "Agatha Christie", 
    subject: "Mystery", 
    driveLink: "https://drive.google.com/file/d/16_RuSqhdkmsSXVKPdVJlPEvZnTvPmL75/view?usp=drive_link", 
    bio: "The legendary 'Queen of Crime', recognized as the best-selling novelist of all time for her genius detective mysteries.", 
    summary: "Ten strangers are lured to an island, where they are executed one by one for their past crimes in this ultimate whodunit." 
  },
  { 
    id: 5, 
    title: "TALES OF THE UNEXPECTED", 
    author: "H. G. Wells", 
    subject: "Mystery", 
    driveLink: "https://drive.google.com/file/d/1tCYl3rZznYsXOSI0V8IUO0mVX-2L0CV5/view?usp=drive_link", 
    bio: "Often called the 'Father of Science Fiction', Wells was a visionary writer who explored futuristic and mysterious themes.", 
    summary: "A collection of thrilling and eerie short stories that challenge the boundaries of reality and human imagination." 
  },
  { 
    id: 6, 
    title: "THE HOUND OF THE BASKERVILLES", 
    author: "Conan Doyle", 
    subject: "Mystery", 
    driveLink: "https://drive.google.com/file/d/1l63cxB4Yx9CHdhdhpKTpJkOfx2jp-Aaa/view?usp=drive_link", 
    bio: "The creator of Sherlock Holmes, the world's most famous detective, and a pioneer of the crime fiction genre.", 
    summary: "Sherlock Holmes investigates a terrifying supernatural hound haunting a family in the foggy moors of Devonshire." 
  },
  { 
    id: 7, 
    title: "The Girl on the Train", 
    author: "Paula Hawkins", 
    subject: "Mystery", 
    driveLink: "https://drive.google.com/file/d/1D7AfHf78rWe_0ByPWHRo8VuFx4nzuJ4H/view?usp=drive_link", 
    bio: "A contemporary British thriller author known for her mastery of psychological suspense and unreliable narrators.", 
    summary: "A gripping psychological thriller where a woman becomes entangled in a murder mystery she witnessed from a train window." 
  },
  { 
    id: 8, 
    title: "The Silent Patient", 
    author: "Alex Michaelides", 
    subject: "Mystery", 
    driveLink: "https://drive.google.com/file/d/1OBJKH3_9pPLVELEqM3AqC_bmb517x4Nx/view?usp=drive_link", 
    bio: "A British-Cypriot author and screenwriter who took the world by storm with his intricate psychological mystery plots.", 
    summary: "A famous painter shoots her husband and falls silent, leaving a psychotherapist obsessed with uncovering her hidden motive." 
  },
  { 
    id: 9, 
    title: "How Much Land Does a Man Need?", 
    author: "Leo Tolstoy", 
    subject: "Short Story", 
    driveLink: "https://drive.google.com/file/d/1i7G7xoUBk77DPDYyNzEkxMGsJi5XA2gc/view?usp=drive_link", 
    bio: "A titan of world literature, this Russian master is famous for his deep philosophical insights and realistic storytelling.", 
    summary: "A profound moral tale about greed and the futility of material accumulation, questioning what truly matters in life." 
  },
  { 
    id: 10, 
    title: "The Bet", 
    author: "Anton Chekhov", 
    subject: "Short Story", 
    driveLink: "https://drive.google.com/file/d/1xQj_l55lPaQqIQnj-vKnzETGHHfdq6UB/view?usp=drive_link", 
    bio: "A master of the short story and modern drama, celebrated for his subtle psychological depth and character studies.", 
    summary: "A high-stakes wager between a banker and a lawyer explores the effects of isolation and the value of freedom." 
  },
  { 
    id: 11, 
    title: "Tolstoy Death Ilyich", 
    author: "Leo Tolstoy", 
    subject: "Philosophical fiction", 
    driveLink: "https://drive.google.com/file/d/1jrDEOd4Dn7Dn2926-OWVRMZkSsrKjEZe/view?usp=drive_link", 
    bio: "Known for his epic novels, Tolstoyâ€™s shorter works are equally powerful explorations of mortality and faith.", 
    summary: "A challenging and philosophical examination of a man's life as he faces his final moments and searches for meaning." 
  },
  { 
    id: 12, 
    title: "The Lottery", 
    author: "Shirley Jackson", 
    subject: "Short Story", 
    driveLink: "https://drive.google.com/file/d/1jlYGOA_k4UUHC5Zfq8GwoDxWBTT1djF-/view?usp=drive_link", 
    bio: "An American writer famed for her works of horror and mystery that reveal the dark side of human communities.", 
    summary: "A shocking story about a small town's annual tradition that serves as a chilling commentary on human nature." 
  },
  { 
    id: 13, 
    title: "THE LANDLADY", 
    author: "Roald Dahl", 
    subject: "Short Story", 
    driveLink: "https://drive.google.com/file/d/1M6Ya7BUz34pmGpGGZtcV_k_AC0skGFVp/view?usp=drive_link", 
    bio: "While beloved for children's books, Dahl was also a master of macabre and darkly humorous adult short stories.", 
    summary: "A young man finds a cozy boarding house with a polite landlady, only to discover she has a very dark secret." 
  },
  { 
    id: 14, 
    title: "The Tell-Tale Heart", 
    author: "Edgar Allan Poe", 
    subject: "Short Story", 
    driveLink: "https://drive.google.com/file/d/1ud80hp2ULpBWHmWT5Qb88wqjrMpVosbk/view?usp=drive_link", 
    bio: "The father of the American short story and the detective genre, known for his gothic tales of mystery and the macabre.", 
    summary: "A classic psychological horror story where a narrator is driven to madness by the sound of a beating heart." 
  },
  { 
    id: 15, 
    title: "Great Lateral thinking puzzles", 
    author: "Poul Sloane", 
    subject: "Puzzles", 
    driveLink: "https://drive.google.com/file/d/1pyrs6TQJE5f_71ZnW91U-CpgOS7gsw4Z/view?usp=drive_link", 
    bio: "An expert on innovation and creative thinking, specializing in challenging logic puzzles that expand the mind.", 
    summary: "A collection of mind-bending puzzles designed to sharpen your thinking skills and help you look at problems differently." 
  },
  { 
    id: 16, 
    title: "Murdle", 
    author: "G. T. Karber", 
    subject: "Puzzles", 
    driveLink: "https://drive.google.com/file/d/1RRddB4mWC07Bp76elT7L41jibqxYrHIw/view?usp=drive_link", 
    bio: "A puzzle designer who modernized the detective mystery into a fun and engaging series of logic deductions.", 
    summary: "Become the detective! Use logic and clues to solve mysteries and find the killer in this interactive puzzle book." 
  },
  { 
    id: 17, 
    title: "The Sherlock Holmes Puzzle Collection", 
    author: "Bernard Myers", 
    subject: "Puzzles", 
    driveLink: "https://drive.google.com/file/d/1ntf_ov4RE_PDpCsMWLUeiwhrZYpDc-8n/view?usp=drive_link", 
    bio: "A specialized puzzle writer who brings the world of Sherlock Holmes to life through complex and fun riddles.", 
    summary: "Sharpen your powers of deduction with a wide variety of puzzles inspired by the adventures of Sherlock Holmes." 
  },
  { 
    id: 18, 
    title: "What is the Name of This Book", 
    author: "Raymond Smullyan", 
    subject: "Puzzles", 
    driveLink: "https://drive.google.com/file/d/10f7Pmnf0BJYChiHODPJ5wQcjpRwIYP_1/view?usp=drive_link", 
    bio: "A renowned mathematician and logician who transformed mathematical principles into captivating logic puzzles.", 
    summary: "A legendary collection of logic puzzles and paradoxes that guide the reader through the foundations of mathematics." 
  }
];

const EnglishLibraryInternalPage: React.FC = () => {
  const { locale, dir } = useLanguage();
  const isAr = locale === 'ar';
  const navigate = useNavigate();

  const [searchTerm, setSearchTerm] = useState('');
  const [subjectFilter, setSubjectFilter] = useState('all');
  const [selectedBio, setSelectedBio] = useState<any>(null);
  const [ripples, setRipples] = useState<{ id: number, x: number, y: number }[]>([]);

  const subjects = useMemo(() => [...new Set(ENGLISH_LIBRARY_DATABASE.map(b => b.subject))], []);

  const filteredContent = useMemo(() => {
    return ENGLISH_LIBRARY_DATABASE.filter(item => {
      const term = searchTerm.toLowerCase();
      const matchesSearch = item.title.toLowerCase().includes(term) || item.author.toLowerCase().includes(term);
      const matchesSub = subjectFilter === 'all' || item.subject === subjectFilter;
      return matchesSearch && matchesSub;
    });
  }, [searchTerm, subjectFilter]);

  const handleMouseMove = (e: React.MouseEvent) => {
    const rect = e.currentTarget.getBoundingClientRect();
    (e.currentTarget as HTMLElement).style.setProperty("--mouse-x", `${e.clientX - rect.left}px`);
    (e.currentTarget as HTMLElement).style.setProperty("--mouse-y", `${e.clientY - rect.top}px`);
  };

  const handleInteraction = (e: React.MouseEvent, action: () => void) => {
    const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();
    setRipples(prev => [...prev, { id: Date.now(), x: e.clientX - rect.left, y: e.clientY - rect.top }]);
    setTimeout(action, 400);
  };

  return (
    <div dir={dir} className="max-w-7xl mx-auto px-4 py-8 animate-in fade-in duration-1000 relative">
      
      <button onClick={() => navigate(-1)} className="mb-10 flex items-center gap-2 text-gray-500 hover:text-red-600 font-black transition-colors group">
        <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 transform group-hover:-translate-x-1 ${isAr ? 'rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
        {isAr ? 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©' : 'Back'}
      </button>

      {/* Smart Search Bar */}
      <div onMouseMove={handleMouseMove} className="glass-panel glass-card-interactive p-8 rounded-[2.5rem] shadow-2xl mb-12 border-white/30 sticky top-24 z-30 backdrop-blur-3xl">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 relative z-10">
          <div className="lg:col-span-2 relative">
            <input 
              type="text" 
              placeholder={isAr ? "Search by title or author..." : "Search by title or author..."}
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full p-4 ps-12 rounded-2xl bg-white/50 dark:bg-gray-900/50 border-2 border-transparent focus:border-red-600 outline-none font-black text-gray-950 dark:text-white transition-all shadow-inner"
            />
            <svg className="absolute start-4 top-4 h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
          </div>
          <select value={subjectFilter} onChange={(e) => setSubjectFilter(e.target.value)} className="p-4 rounded-2xl bg-white/40 dark:bg-gray-800/60 border border-white/10 dark:text-white font-black cursor-pointer appearance-none shadow-sm">
            <option value="all">{isAr ? "All Subjects" : "All Subjects"}</option>
            {subjects.map(s => <option key={s} value={s}>{s}</option>)}
          </select>
        </div>
      </div>

      {/* Book Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
        {filteredContent.map((item) => (
          <div key={item.id} onMouseMove={handleMouseMove} className="glass-panel glass-card-interactive group relative overflow-hidden p-8 rounded-[3rem] border-white/20 flex flex-col justify-between hover:scale-[1.03] transition-all duration-500 h-full shadow-lg">
            {ripples.map(r => <span key={r.id} className="ripple-effect border-red-500/20" style={{ left: r.x, top: r.y }} />)}
            
            <div className="relative z-10">
              <div className="flex justify-between items-start mb-5">
                <span className="bg-red-600 text-white px-3 py-1 rounded-xl text-[9px] font-black uppercase tracking-widest shadow-md">{item.subject}</span>
                <span className="text-3xl filter grayscale group-hover:grayscale-0 transition-all duration-500">ðŸ“–</span>
              </div>
              
              <h2 className="text-2xl font-black text-gray-950 dark:text-white mb-2 group-hover:text-red-600 transition-colors leading-tight tracking-tighter line-clamp-2 h-14 overflow-hidden">{item.title}</h2>
              <p className="text-green-700 dark:text-green-400 font-black text-sm mb-4">{item.author}</p>
              
              {/* AI Summary */}
              <div className="bg-black/5 dark:bg-white/5 p-5 rounded-[1.5rem] border border-white/10 mb-6">
                <p className="text-[9px] text-red-600 font-black uppercase mb-2 flex items-center gap-2">
                  <span className="w-1.5 h-1.5 bg-red-600 rounded-full animate-pulse shadow-[0_0_10px_rgba(220,38,38,0.5)]"></span>
                  Saqr AI Summary
                </p>
                <p className="text-gray-700 dark:text-gray-300 font-medium italic text-sm leading-relaxed line-clamp-3">"{item.summary}"</p>
              </div>
            </div>

            {/* Buttons */}
            <div className="flex flex-col gap-3 z-10">
              <button 
                onClick={(e) => handleInteraction(e as any, () => setSelectedBio(item))}
                className="w-full bg-white/40 dark:bg-white/5 border border-red-500/30 text-gray-900 dark:text-white font-black py-3 rounded-2xl hover:bg-red-600 hover:text-white transition-all text-xs active:scale-95"
              >
                Author Bio
              </button>
              <a 
                href={item.driveLink} 
                target="_blank" 
                rel="noopener noreferrer"
                onMouseDown={(e) => handleInteraction(e as any, () => {})}
                className="relative overflow-hidden w-full bg-gray-950 text-white dark:bg-white dark:text-gray-950 font-black py-4 rounded-[1.5rem] flex items-center justify-center gap-3 shadow-xl active:scale-95 transition-all group/btn"
              >
                {ripples.map(r => <span key={r.id} className="ripple-effect border-red-500/30" style={{ left: r.x, top: r.y }} />)}
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
                <span>Read Content</span>
              </a>
            </div>
          </div>
        ))}
      </div>

      {/* Author Bio Modal */}
      {selectedBio && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 backdrop-blur-xl animate-in fade-in duration-300">
          <div className="glass-panel w-full max-w-lg p-10 rounded-[3rem] border-white/20 shadow-2xl relative animate-in zoom-in-95">
             <button onClick={() => setSelectedBio(null)} className="absolute top-6 end-6 p-2 bg-red-600 text-white rounded-full hover:scale-110 transition-transform">
               <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M6 18L18 6M6 6l12 12" /></svg>
             </button>
             <h3 className="text-3xl font-black text-gray-950 dark:text-white mb-2">{selectedBio.author}</h3>
             <p className="text-red-600 font-black uppercase text-xs tracking-widest mb-6">Historical Bio (AI Bio)</p>
             <p className="text-gray-800 dark:text-gray-200 text-lg leading-relaxed font-medium">"{selectedBio.bio}"</p>
             <div className="mt-8 pt-6 border-t border-black/5 dark:border-white/10 flex justify-center">
                <img src="/school-logo.png" alt="EFIIPS" className="h-10 opacity-30 logo-white-filter" />
             </div>
          </div>
        </div>
      )}

      {/* Footer Branding */}
      <div className="mt-24 flex flex-col items-center gap-4 opacity-15 grayscale">
          <img src="/school-logo.png" alt="EFIIPS" className="h-24 w-auto logo-white-filter" />
          <p className="font-black text-[10px] uppercase tracking-[0.3em] text-gray-500">Emirates Falcon International Private School</p>
      </div>
    </div>
  );
};

export default EnglishLibraryInternalPage;
